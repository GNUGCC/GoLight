{"version":3,"sources":["webpack:///./src/views/NewOrder.vue?5711","webpack:///./src/views/NewOrder.vue","webpack:///./src/views/NewOrder.vue?4af0"],"names":["slot","default-href","id","class","$store","state","items","length","size","style","item","key","timestamp","light","title","name","router-link","remove","help","src","discount","readonly","value","amount","interface","placeholder","method","submit","step","components","IonBackButton","IonButton","IonButtons","IonCol","IonContent","IonFooter","IonGrid","IonHeader","IonImg","IonInput","IonItem","IonLabel","IonPage","IonRow","IonSelect","IonSelectOption","IonText","IonTitle","IonToolbar","MenuBar","computed","this","forEach","price","coupons","coupon","checked","parseInt","$route","params","methods","alert","create","header","message","buttons","present","confirm","commit","push","code","JSON","parse","stringify","result","order","$router","closed","browser","url","hardwareback","hidenavigationbuttons","location","usewkwebview","on","subscribe","order_id","event","startsWith","return_url","close","res","status","__exports__","render"],"mappings":"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","file":"js/chunk-4ce1ffa8.9517a6c4.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./NewOrder.vue?vue&type=style&index=0&id=928b6346&scoped=true&lang=css\"","<template>\n  <ion-page>\n    <ion-header>\n      <ion-toolbar>\n        <ion-buttons slot=\"start\">\n          <ion-back-button :default-href=\"'/temple/' + id\"></ion-back-button>\n        </ion-buttons>\n        <ion-title>點燈祈福</ion-title>\n      </ion-toolbar>\n    </ion-header>\n    <ion-content class=\"new-order\">\n      <ion-grid v-if=\"$store.state.items.length\">\n        <ion-row>\n          <ion-col size=\"12\" style=\"font-size:1.3rem;\">\n            已選燈列表\n          </ion-col>\n        </ion-row>\n        <ion-row class=\"record ion-margin-top\" :key=\"item.timestamp\" v-for=\"item in $store.state.items\">\n          <ion-col size=\"4\">\n            {{ item.light.title }}\n          </ion-col>\n          <ion-col size=\"4\">\n            {{ item.name }}\n          </ion-col>\n          <ion-col class=\"ion-text-right\" size=\"2\">\n            <ion-text :router-link=\"'/new-order-item/' + id + '/' + item.timestamp\">修改</ion-text>\n          </ion-col>\n          <ion-col class=\"ion-text-right\" size=\"2\">\n            <ion-text @click=\"remove(item)\">刪除</ion-text>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n      <ion-grid v-else>\n        <ion-row>\n          <ion-col size=\"12\" style=\"font-size:1.3rem;\">\n            已選燈列表\n          </ion-col>\n        </ion-row>\n        <ion-row class=\"record ion-margin-top\">\n          <ion-col>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n      <ion-grid>\n        <ion-row class=\"ion-margin-bottom ion-padding-bottom\">\n          <ion-col size=\"12\">\n            <ion-button class=\"button-3\" :router-link=\"'/new-order-item/' + id\">+&nbsp;&nbsp;&nbsp;新增</ion-button>\n          </ion-col>\n        </ion-row>\n        <ion-row class=\"ion-margin-top ion-padding-top\">\n          <ion-col size=\"6\">\n            <ion-button class=\"button-1\" :router-link=\"'/coupon-list/' + id\">使用BLESS序號</ion-button>\n          </ion-col>\n          <ion-col size=\"2\">\n            <ion-img @click=\"help\" src=\"/assets/images/icon3.png\" style=\"width:45px;\"/>\n          </ion-col>\n          <ion-col size=\"4\">\n            <ion-text style=\"font-size:0.8rem\" v-show=\"discount\">總折抵{{ discount }}元</ion-text>\n          </ion-col>\n          <ion-col size=\"12\">\n            <ion-item class=\"input\">\n              <ion-label>　　總金額　　</ion-label>\n              <ion-input readonly :value=\"amount\"></ion-input>\n            </ion-item>\n          </ion-col>\n          <ion-col size=\"12\">\n            <ion-item class=\"input select\">\n              <ion-label>　　付款方式　　</ion-label>\n              <ion-select interface=\"popover\" placeholder=\"請選擇\" v-model=\"method\">\n                <ion-select-option value=\"1\">信用卡</ion-select-option>\n                <ion-select-option value=\"2\">銀行轉帳</ion-select-option>\n                <ion-select-option value=\"3\">超商代收</ion-select-option>\n              </ion-select>\n            </ion-item>\n          </ion-col>\n          <ion-col size=\"12\">\n            <ion-button @click=\"submit\" class=\"button-3\">付款</ion-button>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </ion-content>\n    <ion-footer>\n      <menu-bar :step=\"$store.state.items.length ? '4' : '2'\"></menu-bar>\n    </ion-footer>\n  </ion-page>\n</template>\n\n<script>\nimport {\n  createOrder,\n  queryOrder,\n  //   passpay,\n} from \"../api\";\n\nimport {\n  IonBackButton,\n  IonButton,\n  IonButtons,\n  IonCol,\n  IonContent,\n  IonFooter,\n  IonGrid,\n  IonHeader,\n  IonImg,\n  IonInput,\n  IonItem,\n  IonLabel,\n  IonPage,\n  IonRow,\n  IonSelect,\n  IonSelectOption,\n  IonText,\n  IonTitle,\n  IonToolbar,\n  alertController\n} from \"@ionic/vue\";\n\nimport {\n  InAppBrowser\n} from \"@awesome-cordova-plugins/in-app-browser\";\n\nimport MenuBar from \"@/views/MenuBar.vue\";\n\nexport default {\n  components: {\n    IonBackButton,\n    IonButton,\n    IonButtons,\n    IonCol,\n    IonContent,\n    IonFooter,\n    IonGrid,\n    IonHeader,\n    IonImg,\n    IonInput,\n    IonItem,\n    IonLabel,\n    IonPage,\n    IonRow,\n    IonSelect,\n    IonSelectOption,\n    IonText,\n    IonTitle,\n    IonToolbar,\n    MenuBar\n  },\n  computed: {\n    amount() {\n      let amount = 0 - this.discount;\n      this.$store.state.items.forEach((item) => {\n        amount += item.light.price;\n      });\n      return amount > 0 ? amount : 0;\n    },\n    discount() {\n      let discount = 0;\n      this.$store.state.coupons.forEach((coupon) => {\n        if (coupon.checked) {\n          discount += parseInt(coupon.discount);\n        }\n      });\n      return discount;\n    }\n  },\n  data() {\n    return {\n      id: this.$route.params.id,\n      method: \"\"\n    };\n  },\n  methods: {\n    async help() {\n      const alert = await alertController.create({\n        header: \"BLESS序號說明\",\n        message: \"1) 點選BLESS序號按鈕，可進入BLESS序號輸入頁面，輸入序號則可折抵金額。<br>2) 多張序號可一併使用，要使用的序號，請在欄位前方點選選取，按下使用則開始使用。<br>3) 一個序號只能使用一次。<br>4) 序號無法兌換現金或找零，一個序號請一次使用完畢。\",\n        buttons: [\"OK\"]\n      });\n      await alert.present();\n    },\n    remove(item) {\n      if (confirm(`確定要刪除${item.name}的${item.light.title}嗎？`)) {\n        this.$store.commit(\"remove\", item);\n      }\n    },\n    submit() {\n      if (!this.$store.state.items.length) {\n        alert(\"請新增燈種\");\n        return;\n      }\n      if (this.method === \"\") {\n        alert(\"請選擇付款方式\");\n        return;\n      }\n      if (confirm(`確定要送出訂單嗎？`)) {\n        let coupons = [];\n        this.$store.state.coupons.forEach((coupon) => {\n          if (coupon.checked) {\n            coupons.push(coupon.code);\n          }\n        });\n        //pay\n        createOrder({\n          items: JSON.parse(JSON.stringify(this.$store.state.items)),\n          coupons,\n          method: this.method\n        }, (result) => {\n          this.$store.commit(\"purge\");\n          if(result.order && result.order.id) {\n            this.$router.push({name: \"OrderCompleted\", params: {id: result.order.id}});\n            return\n          }\n          let closed;\n          let browser = InAppBrowser.create(result.url, \"_blank\", {\n            hardwareback: \"no\",\n            hidenavigationbuttons: \"yes\",\n            location: \"no\",\n            usewkwebview: \"yes\"\n          });\n          browser.on(\"exit\").subscribe(() => {\n            if (!closed) {\n              this.$router.push({name: \"Order\", params: {id: result.order_id}});\n            }\n          });\n          browser.on(\"loadstop\").subscribe((event) => {\n            if (event.url.startsWith(result.return_url)) {\n              closed = true;\n              browser.close();\n              queryOrder(result.order_id, (res) => {\n\n                if (res.order.status == 2) {\n                  this.$router.push({name: \"OrderCompleted\", params: {id: result.order_id}});\n                } else {\n                  this.$router.push({name: \"Order\", params: {id: result.order_id}});\n                }\n              });\n            }\n          });\n        });\n        //pass pay\n        // createOrder({\n        //   items: JSON.parse(JSON.stringify(this.$store.state.items)),\n        //   coupons,\n        //   method: this.method\n        // }, (result) => {\n        //   let orderId = result.order_id\n        //   if(!orderId) {\n        //     orderId = result.order.id\n        //   }\n        //   passpay({\n        //     orderId: orderId,\n        //   }, result => {\n        //     this.$router.push({name: \"OrderCompleted\", params: {id: result.orderId}});\n        //   })\n        // });\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\nion-col {\n  color: #333;\n}\n\nion-grid {\n  margin: 20px 20px 0 20px;\n}\n\n.button-1 {\n  --border-radius: 10px;\n}\n\n.record {\n  box-shadow: 1px 1px 2px 2px rgba(0, 0, 0, 0.2);\n  padding: 10px;\n}\nion-select {\n  --placeholder-opacity: 1;\n}\n</style>\n","import { render } from \"./NewOrder.vue?vue&type=template&id=928b6346&scoped=true\"\nimport script from \"./NewOrder.vue?vue&type=script&lang=js\"\nexport * from \"./NewOrder.vue?vue&type=script&lang=js\"\n\nimport \"./NewOrder.vue?vue&type=style&index=0&id=928b6346&scoped=true&lang=css\"\n\nimport exportComponent from \"C:\\\\Users\\\\mark\\\\Downloads\\\\mazulight-code\\\\mazulight-app\\\\mazulight-app-master\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-928b6346\"]])\n\nexport default __exports__"],"sourceRoot":""}