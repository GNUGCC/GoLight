(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2214f1"],{ca96:function(e,t,i){"use strict";i.r(t),i.d(t,"BluetoothLeWeb",(function(){return o})),i.d(t,"BluetoothLe",(function(){return r}));var a=i("1547"),n=i("a460");async function s(e,t,i){let a;return Promise.race([e,new Promise((e,n)=>{a=setTimeout(()=>n(i),t)})]).finally(()=>clearTimeout(a))}class o extends a["c"]{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4}async initialize(){if("undefined"===typeof navigator||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");const e=await navigator.bluetooth.getAvailability();if(!e)throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(e){const t=this.getFilters(e),i=await navigator.bluetooth.requestDevice({filters:t.length?t:void 0,optionalServices:null===e||void 0===e?void 0:e.optionalServices,acceptAllDevices:0===t.length});this.deviceMap.set(i.id,i);const a=this.getBleDevice(i);return a}async requestLEScan(e){this.requestBleDeviceOptions=e;const t=this.getFilters(e);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceived),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceived),this.scan=await navigator.bluetooth.requestLEScan({filters:t.length?t:void 0,acceptAllAdvertisements:0===t.length,keepRepeatedDevices:null===e||void 0===e?void 0:e.allowDuplicates})}onAdvertisementReceived(e){var t,i;const a=e.device.id;r.deviceMap.set(a,e.device);const s=!r.discoveredDevices.has(a);if(s||(null===(t=r.requestBleDeviceOptions)||void 0===t?void 0:t.allowDuplicates)){r.discoveredDevices.set(a,!0);const t=r.getBleDevice(e.device),s={device:t,localName:t.name,rssi:e.rssi,txPower:e.txPower,manufacturerData:Object(n["c"])(e.manufacturerData),serviceData:Object(n["c"])(e.serviceData),uuids:null===(i=e.uuids)||void 0===i?void 0:i.map(n["d"])};r.notifyListeners("onScanResult",s)}}async stopLEScan(){var e;(null===(e=this.scan)||void 0===e?void 0:e.active)&&this.scan.stop(),this.scan=null}async getDevices(e){const t=await navigator.bluetooth.getDevices(),i=t.map(e=>{this.deviceMap.set(e.id,e);const t=this.getBleDevice(e);return t});return{devices:i}}async getConnectedDevices(e){const t=await navigator.bluetooth.getDevices(),i=t.filter(e=>{var t;return null===(t=e.gatt)||void 0===t?void 0:t.connected}).map(e=>{this.deviceMap.set(e.id,e);const t=this.getBleDevice(e);return t});return{devices:i}}async connect(e){var t,i;const a=this.getDeviceFromMap(e.deviceId);a.removeEventListener("gattserverdisconnected",this.onDisconnected),a.addEventListener("gattserverdisconnected",this.onDisconnected);const n=Symbol();if(void 0===a.gatt)throw new Error("No gatt server available.");try{const i=null!==(t=e.timeout)&&void 0!==t?t:this.DEFAULT_CONNECTION_TIMEOUT;await s(a.gatt.connect(),i,n)}catch(o){throw await(null===(i=a.gatt)||void 0===i?void 0:i.disconnect()),o===n?new Error("Connection timeout"):o}}onDisconnected(e){const t=e.target.id,i="disconnected|"+t;r.notifyListeners(i,null)}async createBond(e){throw this.unavailable("createBond is not available on web.")}async isBonded(e){throw this.unavailable("isBonded is not available on web.")}async disconnect(e){var t;null===(t=this.getDeviceFromMap(e.deviceId).gatt)||void 0===t||t.disconnect()}async getServices(e){var t,i;const a=null!==(i=await(null===(t=this.getDeviceFromMap(e.deviceId).gatt)||void 0===t?void 0:t.getPrimaryServices()))&&void 0!==i?i:[],n=[];for(const s of a){const e=await s.getCharacteristics(),t=[];for(const i of e)t.push({uuid:i.uuid,properties:this.getProperties(i),descriptors:await this.getDescriptors(i)});n.push({uuid:s.uuid,characteristics:t})}return{services:n}}async getDescriptors(e){try{const t=await e.getDescriptors();return t.map(e=>({uuid:e.uuid}))}catch(t){return[]}}getProperties(e){return{broadcast:e.properties.broadcast,read:e.properties.read,writeWithoutResponse:e.properties.writeWithoutResponse,write:e.properties.write,notify:e.properties.notify,indicate:e.properties.indicate,authenticatedSignedWrites:e.properties.authenticatedSignedWrites,reliableWrite:e.properties.reliableWrite,writableAuxiliaries:e.properties.writableAuxiliaries}}async getCharacteristic(e){var t;const i=await(null===(t=this.getDeviceFromMap(e.deviceId).gatt)||void 0===t?void 0:t.getPrimaryService(null===e||void 0===e?void 0:e.service));return null===i||void 0===i?void 0:i.getCharacteristic(null===e||void 0===e?void 0:e.characteristic)}async getDescriptor(e){const t=await this.getCharacteristic(e);return null===t||void 0===t?void 0:t.getDescriptor(null===e||void 0===e?void 0:e.descriptor)}async readRssi(e){throw this.unavailable("readRssi is not available on web.")}async read(e){const t=await this.getCharacteristic(e),i=await(null===t||void 0===t?void 0:t.readValue());return{value:i}}async write(e){const t=await this.getCharacteristic(e);let i;i="string"===typeof e.value?Object(n["b"])(e.value):e.value,await(null===t||void 0===t?void 0:t.writeValueWithResponse(i))}async writeWithoutResponse(e){const t=await this.getCharacteristic(e);let i;i="string"===typeof e.value?Object(n["b"])(e.value):e.value,await(null===t||void 0===t?void 0:t.writeValueWithoutResponse(i))}async readDescriptor(e){const t=await this.getDescriptor(e),i=await(null===t||void 0===t?void 0:t.readValue());return{value:i}}async writeDescriptor(e){const t=await this.getDescriptor(e);let i;i="string"===typeof e.value?Object(n["b"])(e.value):e.value,await(null===t||void 0===t?void 0:t.writeValue(i))}async startNotifications(e){const t=await this.getCharacteristic(e);null===t||void 0===t||t.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChanged),null===t||void 0===t||t.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChanged),await(null===t||void 0===t?void 0:t.startNotifications())}onCharacteristicValueChanged(e){var t,i;const a=e.target,n=`notification|${null===(t=a.service)||void 0===t?void 0:t.device.id}|${null===(i=a.service)||void 0===i?void 0:i.uuid}|${a.uuid}`;r.notifyListeners(n,{value:a.value})}async stopNotifications(e){const t=await this.getCharacteristic(e);await(null===t||void 0===t?void 0:t.stopNotifications())}getFilters(e){var t;const i=[];for(const a of null!==(t=null===e||void 0===e?void 0:e.services)&&void 0!==t?t:[])i.push({services:[a],name:null===e||void 0===e?void 0:e.name,namePrefix:null===e||void 0===e?void 0:e.namePrefix});return((null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.namePrefix))&&0===i.length&&i.push({name:e.name,namePrefix:e.namePrefix}),i}getDeviceFromMap(e){const t=this.deviceMap.get(e);if(void 0===t)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return t}getBleDevice(e){var t;const i={deviceId:e.id,name:null!==(t=e.name)&&void 0!==t?t:void 0,uuids:e.uuids};return i}}const r=new o}}]);
//# sourceMappingURL=chunk-2d2214f1.3ae3d0b4.js.map